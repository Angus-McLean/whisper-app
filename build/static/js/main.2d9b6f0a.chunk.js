(this["webpackJsonpwhisper-app"]=this["webpackJsonpwhisper-app"]||[]).push([[0],{23:function(e,t,a){e.exports=a(40)},28:function(e,t,a){},29:function(e,t,a){},39:function(e,t,a){},40:function(e,t,a){"use strict";a.r(t);var n=a(1),i=a.n(n),s=a(20),r=a.n(s),o=(a(28),a(4)),l=a(5),c=a(12),d=a(7),m=a(6),u=(a(29),a(13)),p=a.n(u),h=a(15),v=function(e){Object(d.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).joinMeeting=function(){var e=Object(h.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),console.log("LandingPage.joinMeeting",t),n.props.goToMeeting({meetingId:document.getElementById("meetingField").value,userId:document.getElementById("userField").value});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.props=e,n}return Object(l.a)(a,[{key:"render",value:function(){return i.a.createElement("div",{className:"landing section"},i.a.createElement("div",{className:"landing text-block-8"},"Join Whisper Meeting"),i.a.createElement("div",{className:"landing text-block-9"},"Video conferencing like they're right beside you.."),i.a.createElement("div",{className:"landing text-block-9"}," ",i.a.createElement("a",{class:"nav-link",href:"./pages/notebook/"},"Browse Notebook")),i.a.createElement("div",{className:"landing form-block w-form"},i.a.createElement("form",{id:"email-form",onSubmit:this.joinMeeting,name:"email-form","data-name":"Email Form",className:"landing form"},i.a.createElement("input",{type:"text",className:"landing text-field w-input",maxLength:"256",name:"name","data-name":"Name",placeholder:"Meeting ID..",id:"meetingField",defaultValue:"WhisperMeetingDemo"}),i.a.createElement("input",{type:"text",className:"landing text-field w-input",maxLength:"256",name:"name","data-name":"Name",placeholder:"Your Name..",id:"userField"}),i.a.createElement("input",{type:"submit",value:"Join Meeting","data-wait":"Please wait...",className:"landing submit-button w-button"})),i.a.createElement("div",{className:"landing w-form-done"},i.a.createElement("div",null,"Thank you! Your submission has been received!")),i.a.createElement("div",{className:"landing w-form-fail"},i.a.createElement("div",null,"Oops! Something went wrong while submitting the form."))))}}]),a}(n.Component),g=a(16),f=a(9),b=(a(31),a(42),a(34),a(41),a(17)),w=window.JitsiMeetExternalAPI||{},E=function(e){Object(d.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={status:"closed",mute:!1},n}return Object(l.a)(a,[{key:"answerCall",value:function(){this.jitsiCallObj=new w("meet.jit.si",{roomName:this.props.message.text,parentNode:document.getElementById(this.props.message.text),width:"100%",height:"100%",userInfo:{displayName:"asdfwev"},configOverwrite:{prejoinPageEnabled:!1,startWithAudioMuted:!1}}),window.jitsiCallObj=this.jitsiCallObj,this.jitsiCallObj.executeCommand("sendTones",{tones:"99",pause:0,duration:1}),this.setState({status:"active"})}},{key:"toggleMute",value:function(){alert(this.state.mute)}},{key:"closeCall",value:function(){var e=this;this.jitsiCallObj.executeCommand("hangup"),setTimeout((function(){document.getElementById(e.props.message.text).innerHTML=""}),100),this.setState({status:"closed"})}},{key:"render",value:function(){var e=this.props.message,t=e.uid===window.GLOBAL.meeting.userId;return"closed"===this.state.status?i.a.createElement("div",{className:"div-block-11 "+(t?"":"received")},i.a.createElement("div",null,i.a.createElement("div",{className:"div-block-10 "+(t?"":"received")},i.a.createElement("div",{className:"text-block-3"},"Live Whisper.."),i.a.createElement("div",{style:{display:"flex",alignItems:"center"}},i.a.createElement("div",{style:{background:"url(/images/ellipsis.gif)",backgroundPosition:"center",height:"60px",width:"80%"}}),i.a.createElement("div",{className:"div-block-9",onClick:this.answerCall.bind(this)},i.a.createElement("i",{style:{color:"green"},className:"fa fa-phone"})))),i.a.createElement("div",null,e.uid," -- ",e.createdAt&&e.createdAt.toDate().toLocaleString()),i.a.createElement("div",{id:e.text,style:{display:"none"}}))):"active"===this.state.status?i.a.createElement("div",{className:"div-block-11 "+(t?"":"received")},i.a.createElement("div",null,i.a.createElement("div",{className:"div-block-10 "+(t?"":"received"),style:{display:"flex",alignItems:"center"}},i.a.createElement("div",{style:{background:"url(/images/audiosoundwave.gif) 50% 50% / contain",height:"60px",width:"80%"}}),i.a.createElement("div",{className:"div-block-9",onClick:this.closeCall.bind(this)},i.a.createElement("i",{style:{color:"red"},className:"fa fa-times"}))),i.a.createElement("div",null,e.uid," -- ",e.createdAt&&e.createdAt.toDate().toLocaleString()),i.a.createElement("div",{id:e.text,style:{display:"none"}}))):void 0}}]),a}(n.Component),y=function(e){Object(d.a)(a,e);var t=Object(m.a)(a);function a(e){return Object(o.a)(this,a),t.call(this,e)}return Object(l.a)(a,[{key:"render",value:function(){var e=this.props.message,t=e.uid===window.GLOBAL.meeting.userId;return"recording"===e.type?i.a.createElement("div",{className:"div-block-11 "+(t?"":"received")},i.a.createElement("div",null,i.a.createElement("div",{className:"div-block-10 "+(t?"":"received")},i.a.createElement("figure",null,i.a.createElement("audio",{style:{margin:"10px 5px 5px 10px"},controls:!0,src:e.text}))),i.a.createElement("div",{style:{marginTop:"-10px"}},e.uid," -- ",e.createdAt&&e.createdAt.toDate().toLocaleTimeString()))):"call"===e.type?i.a.createElement(E,{message:e}):"update"===e.type?i.a.createElement(i.a.Fragment,null,i.a.createElement("div",null,i.a.createElement("div",{style:{textAlign:"center"}},i.a.createElement("div",null,e.text)))):i.a.createElement("div",{className:"div-block-11 "+(t?"":"received")},i.a.createElement("div",null,i.a.createElement("div",{className:"div-block-10 "+(t?"":"received")},i.a.createElement("div",{className:"text-block-3"},e.text)),i.a.createElement("div",{style:{marginTop:"-2px"}},e.uid," -- ",e.createdAt&&e.createdAt.toDate().toLocaleTimeString())))}}]),a}(n.Component),k=function(e){Object(d.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).bottomRef=i.a.createRef(),n}return Object(l.a)(a,[{key:"render",value:function(){var e=this;return setTimeout((function(){e.bottomRef.current&&e.bottomRef.current.scrollIntoView({behavior:"smooth"})}),100),i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"div-block-6"},i.a.createElement("div",{className:"text-block"},"Chat with ",this.props.selectedUser)),i.a.createElement("div",{style:{overflow:"scroll",height:"78vh"}},this.props.messages&&this.props.messages.reverse().map((function(e){return i.a.createElement(y,{key:e.id,message:e})})),i.a.createElement("div",{style:{paddingTop:"25vh"}},i.a.createElement("span",{ref:this.bottomRef}))))}}]),a}(n.Component),j=a(14),O=a(22),N=function(e){Object(d.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).startRecording=function(){n.setState({record:!0})},n.stopRecording=function(){var e=Object(c.a)(n);e.setState({record:!1}),setTimeout((function(){return e.setState({record:!1})}),100)},n.state={record:!1},console.log(a,Object(c.a)(n)),n.state.record||setTimeout((function(){return n.startRecording()}),1),n}return Object(l.a)(a,[{key:"onData",value:function(e){console.log("chunk of real-time data is: ",e)}},{key:"onStop",value:function(e){console.log("recordedBlob is: ",e,this),this.saveToFirebase(e)}},{key:"saveToFirebase",value:function(e){var t=this,a=this,n=this.props.meeting.userId;return a.props.storageRef.child("uploads/"+n+"-"+e.stopTime+".mp3").put(e.blob,{contentType:"audio/mp3"}).then((function(e){e.ref.getDownloadURL().then((function(i){console.log("audioUpload callback",e),a.props.messagesRef.add({text:i,type:"recording",createdAt:f.a.firestore.FieldValue.serverTimestamp(),from:n,uid:n,to:t.props.selectedUser})}))}))}},{key:"render",value:function(){return i.a.createElement("div",{style:{width:"100%",height:"100%"}},i.a.createElement(O.ReactMic,{record:this.state.record,className:"sound-wave",mimeType:"audio/webm",onStop:this.onStop.bind(this),autoGainControl:!0,strokeColor:"#9b9b9b",width:"300",backgroundColor:"#000813"}))}}]),a}(i.a.Component),x=function(e){Object(d.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).sendMessage=function(){var e=Object(h.a)(p.a.mark((function e(t){var a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==n.state.inputValue){e.next=2;break}return e.abrupt("return");case 2:return t.preventDefault(),a=n.props.meeting.userId,e.next=6,n.props.messagesRef.add({type:"text",text:n.state.inputValue,createdAt:f.a.firestore.FieldValue.serverTimestamp(),from:a,uid:a,to:n.props.selectedUser});case 6:n.state.inputValue="";case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.sendWhisper=function(){var e=Object(h.a)(p.a.mark((function e(t){var a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.props.meeting.userId,e.next=3,n.props.whispersRef.add({from:a,text:"whispercall-"+Date.now(),to:n.props.selectedUser,createdAt:f.a.firestore.FieldValue.serverTimestamp()});case 3:return e.next=5,n.props.messagesRef.add({type:"update",createdAt:f.a.firestore.FieldValue.serverTimestamp(),from:a,uid:a,text:a+" started a Whisper with "+n.props.selectedUser,to:n.props.selectedUser});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.state={inputType:"text",inputValue:""},n.audioRecRef=i.a.createRef(),n}return Object(l.a)(a,[{key:"render",value:function(){var e,t=this;return"text"===this.state.inputType?i.a.createElement(i.a.Fragment,null,i.a.createElement("form",{onSubmit:this.sendMessage,className:"div-block-7"},i.a.createElement("input",(e={className:"text-block-2",type:"text",value:this.state.inputValue,onChange:function(e){return t.setState({inputValue:e.target.value})},placeholder:"Type here...","aria-describedby":"button-addon2"},Object(j.a)(e,"className","form-control rounded-0 border-0 py-4 bg-light"),Object(j.a)(e,"style",{background:"transparent",width:"100%",border:"none",color:"gray",height:"min-content"}),e)),i.a.createElement("div",{className:"div-block-8"},i.a.createElement("div",{className:"div-block-9",onClick:this.sendMessage},i.a.createElement("i",{className:"fa fa-send"})),i.a.createElement("div",{className:"div-block-9",onClick:this.sendWhisper},i.a.createElement("i",{style:{color:"green"},className:"fa fa-phone"})),i.a.createElement("div",{className:"div-block-9",onClick:function(){t.setState({inputType:"record"})}},i.a.createElement("i",{style:{color:"rgb(244, 101, 36)"},className:"fa fa-bullseye"}))))):"record"===this.state.inputType?i.a.createElement(i.a.Fragment,null,i.a.createElement("form",{onSubmit:this.sendMessage,className:"div-block-7"},i.a.createElement(N,{ref:this.audioRecRef,meeting:this.props.meeting,storageRef:this.props.storageRef,messagesRef:this.props.messagesRef,selectedUser:this.props.selectedUser}),i.a.createElement("div",{className:"div-block-8"},i.a.createElement("div",{className:"div-block-9",onClick:function(){console.log(t.audioRecRef&&t.audioRecRef.current),t.audioRecRef.current.stopRecording(),setTimeout((function(){t.setState({inputType:"text"})}),100)}},i.a.createElement("i",{className:"fa fa-stop"}))))):void 0}}]),a}(n.Component),C=function(e){Object(d.a)(a,e);var t=Object(m.a)(a);function a(e){return Object(o.a)(this,a),t.call(this,e)}return Object(l.a)(a,[{key:"render",value:function(){var e=this;console.log("AttendeesList",this);var t=this,a=window.GLOBAL.meeting.userId;return i.a.createElement("div",{className:"div-block-5",style:{borderBottom:"1px solid #9b9b9b",height:"15vh",overflowY:"scroll"}},i.a.createElement("div",{className:"w-layout-grid green",style:{}},i.a.createElement("div",{className:(this.props.selectedUser===a?"selected":"")+" div-block-3"},i.a.createElement("div",{className:"div-block-4 green"},i.a.createElement("div",{className:"text-block"},a," (You)"))),i.a.createElement("div",{className:("Everyone"===this.props.selectedUser?"selected":"")+" div-block-3",onClick:function(){t.props.setSelectedUser("Everyone")}},i.a.createElement("div",{className:"div-block-4 green"},i.a.createElement("div",{className:"text-block"},"Everyone"))),this.props.attendees&&this.props.attendees.reverse().map((function(a){return i.a.createElement("div",{className:(e.props.selectedUser===a.userId?"selected":"")+" div-block-3",onClick:function(){t.props.setSelectedUser(a.userId)},key:a.userId},i.a.createElement("div",{className:"div-block-4 green"},i.a.createElement("div",{className:"text-block"},a.userId)))}))))}}]),a}(n.Component),I=window.JitsiMeetExternalAPI||{},A=function(e){Object(d.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(o.a)(this,a),n=t.call(this,e),console.log("WhisperComp",Object(c.a)(n),e),n.state={mute:!1},n.autoAnswered=!1,n}return Object(l.a)(a,[{key:"answerCall",value:function(){var e=this;this.jitsiCallObj=new I("meet.jit.si",{roomName:this.props.whisper.text,parentNode:document.getElementById("whisper-jitsi-container"),width:"100%",height:"100%",userInfo:{displayName:window.GLOBAL.meeting.userId},configOverwrite:{prejoinPageEnabled:!1,startWithAudioMuted:!1}}),window.jitsiCallObj=this.jitsiCallObj,this.jitsiCallObj.executeCommand("sendTones",{tones:"99",pause:0,duration:1});var t=window.GLOBAL.meeting.userId;this.props.messagesRef.add({type:"update",createdAt:f.a.firestore.FieldValue.serverTimestamp(),from:t,uid:t,text:t+" joined "+this.props.whisper.from+"'s Whisper",to:t===this.props.whisper.to?this.props.whisper.from:this.props.whisper.to});setTimeout((function(){e.props.whispersRef.doc(e.props.whisper.id).update(Object(j.a)({},"status-"+window.GLOBAL.meeting.userId,"active"))}),100)}},{key:"toggleMute",value:function(){}},{key:"closeCall",value:function(){this.jitsiCallObj&&this.jitsiCallObj.executeCommand("hangup"),setTimeout((function(){(document.getElementById("whisper-jitsi-container")||{}).innerHTML=""}),100);var e=window.GLOBAL.meeting.userId;this.props.messagesRef.add({type:"update",createdAt:f.a.firestore.FieldValue.serverTimestamp(),from:e,uid:e,text:e+" left "+this.props.whisper.from+"'s Whisper",to:this.props.selectedUser}),this.props.whispersRef.doc(this.props.whisper.id).update(Object(j.a)({},"status-"+window.GLOBAL.meeting.userId,"closed"))}},{key:"render",value:function(){if(console.log("WhisperComp.render",this),!this.props.whisper)return i.a.createElement(i.a.Fragment,null);var e=window.GLOBAL.meeting.userId;if(this.props.whisper.from===e&&!this.autoAnswered&&("ringing"==this.props.whisper["status-"+e]||!this.props.whisper["status-"+e])){var t=this;this.autoAnswered=!0,setTimeout((function(){return t.answerCall()}),0)}var a=i.a.createElement("div",{className:"div-block-4 green",style:{margin:"20px"}},i.a.createElement("div",{className:"div-block-4 green",style:{width:"fit-content"}},i.a.createElement("div",{className:"text-block"},i.a.createElement("div",{className:"div-block-4 green"},i.a.createElement("div",{className:"text-block"},"Whispering with ",this.props.whisper.from===window.GLOBAL.meeting.userId?this.props.whisper.to:this.props.whisper.from))))),n=i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{style:{display:"flex",alignItems:"center"}},i.a.createElement("div",{style:{background:"url(/images/ellipsis.gif)",backgroundPosition:"center",backgroundRepeat:"no-repeat",height:"2vh",width:"80%"}}),i.a.createElement("div",{className:"div-block-9",onClick:this.answerCall.bind(this)},i.a.createElement("i",{style:{color:"green"},className:"fa fa-phone"})),i.a.createElement("div",{className:"div-block-9",onClick:this.closeCall.bind(this)},i.a.createElement("i",{style:{color:"red"},className:"fa fa-times"})))),s={ringing:n,undefined:n,active:i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{style:{display:"flex",alignItems:"center"}},i.a.createElement("div",{style:{background:"url(/images/audiosoundwave.gif) 50% 50% / cover",backgroundRepeat:"no-repeat",height:"2vh",width:"80%"}}),i.a.createElement("div",{className:"div-block-9",onClick:this.closeCall.bind(this)},i.a.createElement("i",{style:{color:"red"},className:"fa fa-times"}))))},r=i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{id:"incomingCalls",style:{position:"fixed",top:"78%",height:"25vh",width:"inherit",borderTop:"1px solid #9b9b9b",background:"inherit"}},i.a.createElement("div",null,a,s[this.props.whisper&&this.props.whisper["status-"+window.GLOBAL.meeting.userId]]),i.a.createElement("div",{id:"whisper-jitsi-container",style:{display:"none"}})));return i.a.createElement(i.a.Fragment,null,r)}}]),a}(n.Component);f.a.initializeApp({apiKey:"AIzaSyCgNBwvWRmiD-XKVVwPlXtfeFgDxrdS1Cc",authDomain:"ecse542-whisper.firebaseapp.com",databaseURL:"https://ecse542-whisper.firebaseio.com",projectId:"ecse542-whisper",storageBucket:"ecse542-whisper.appspot.com",messagingSenderId:"994712361483",appId:"1:994712361483:web:47d47d3f160de1a275450e",measurementId:"G-S42HK278KF"});var L=f.a.firestore();window.firebase=f.a,window.addEventListener("beforeunload",(function(){setTimeout((function(){L.collection("meetings").doc(window.GLOBAL.meeting.meetingId).collection("attendees").doc(window.GLOBAL.meeting.userId).delete()}),1)}));var R=function(e){document.body.style.background="#000813";var t=e?e.meeting.meetingId:window.GLOBAL.meeting.meetingId,a=e?e.meeting.userId:window.GLOBAL.meeting.userId,s=L.collection("meetings").doc(t);s.set({meetingId:t},{merge:!0});var r=s.collection("messages"),o=s.collection("whispers"),l=s.collection("attendees"),c=f.a.storage().ref(),d=Object(n.useState)("Everyone"),m=Object(g.a)(d,2),u=m[0],p=m[1];console.log("ChatRoom",e,s),l.doc(a).set({userId:a},{merge:!0});var h=Object(b.a)(l,{idField:"id"}),v=Object(g.a)(h,1)[0],w=v?v.filter((function(e){return e.userId!==a})):[],E=Object(b.a)(o.orderBy("createdAt","desc").limit(10),{idField:"id"}),y=Object(g.a)(E,1)[0],j=y?y.filter((function(e){var t=e.to===a|"Everyone"===e.to,n=e.from===a,i="closed"===e["status-"+a],s=!!e["status-"+a],r=!!e.createdAt&&Date.now()-e.createdAt.toDate()<1e5;return!i&&(t||n)&&(r||s)})).reverse():[],O=Object(b.a)(r.orderBy("createdAt","desc").limit(100),{idField:"id"}),N=Object(g.a)(O,1)[0],I=N?N.filter((function(e){var t=e.from===a&&e.to===u,n=e.to===a&&e.from===u,i="Everyone"===e.to&&"Everyone"===u;return t||n||i})):[];return console.log("ChatRoom",e,s),i.a.createElement("div",{className:"div-block-2",style:{position:"fixed"}},i.a.createElement("div",null,i.a.createElement("div",{className:"div-block-6"},i.a.createElement("div",{className:"text-block"},"Whisper Meeting Attendees"))),i.a.createElement(C,{attendees:w,selectedUser:u,setSelectedUser:p}),i.a.createElement(k,{messages:I,selectedUser:u,height:"15vh"}),i.a.createElement(A,{whispersRef:o,whisper:j[0],messagesRef:r,selectedUser:u}),i.a.createElement(x,{meeting:e.meeting,whispersRef:o,messagesRef:r,storageRef:c,selectedUser:u}))},T=window.JitsiMeetExternalAPI||{},B=!1,M=function(e){Object(d.a)(a,e);var t=Object(m.a)(a);function a(e){return Object(o.a)(this,a),t.call(this,e)}return Object(l.a)(a,[{key:"render",value:function(){var e=this;return setTimeout((function(){B||(B=!0,window.api=new T("meet.jit.si",{roomName:e.props.meeting.meetingId,parentNode:document.getElementById("MainJitsi"),width:"100%",height:"100%",userInfo:{displayName:e.props.meeting.userId},configOverwrite:{prejoinPageEnabled:!1}}))}),500),i.a.createElement("div",{id:"MainJitsi"})}}]),a}(n.Component),S=(a(39),function(e){Object(d.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={page:"join"},n}return Object(l.a)(a,[{key:"goToMeeting",value:function(e){this.setState({meeting:e}),this.setState({page:"meeting"}),console.log("App.goToMeeting",e,this),window.GLOBAL=window.GLOBAL||{},window.GLOBAL.meeting=e}},{key:"render",value:function(){return this.state?"join"===this.state.page?i.a.createElement(v,{goToMeeting:this.goToMeeting.bind(this)}):i.a.createElement(i.a.Fragment,null,i.a.createElement(R,{meeting:this.state.meeting}),i.a.createElement("div",{className:"div-block"},i.a.createElement(M,{meeting:this.state.meeting}))):i.a.createElement(i.a.Fragment,null)}}]),a}(n.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(S,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[23,1,2]]]);
//# sourceMappingURL=main.2d9b6f0a.chunk.js.map